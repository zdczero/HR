<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Insight - 職能適性測驗</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-slate-800">

    <div id="page-landing" class="min-h-screen flex flex-col items-center justify-center p-4 text-center">
        <div class="w-20 h-20 bg-blue-600 rounded-2xl flex items-center justify-center mb-6 shadow-lg transform -rotate-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
        </div>
        <h1 class="text-4xl font-bold text-slate-900 mb-4">HR Insight <br><span class="text-blue-600">職能適性測驗</span></h1>
        <p class="text-slate-500 max-w-md mb-8 leading-relaxed">
            這是一份關於工作風格與團隊協作的評估。請憑直覺回答以下問題，只需 2 分鐘，即可完成。
        </p>
        
        <div class="space-y-4 w-full max-w-sm">
            <input type="text" id="candidate-name" placeholder="請輸入您的姓名" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
            <button onclick="startQuiz()" class="w-full bg-slate-900 text-white font-bold py-3 rounded-lg hover:bg-slate-800 transition shadow-lg">開始測驗</button>
        </div>
        <p class="mt-8 text-xs text-slate-400">© 2025 HR Insight System</p>
    </div>

    <div id="page-quiz" class="hidden min-h-screen flex-col items-center justify-center p-4">
        <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl p-8 fade-in">
            <div class="flex justify-between items-center mb-6">
                <span class="text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">Question <span id="q-current">1</span>/<span id="q-total">6</span></span>
                <div class="h-2 w-24 bg-slate-100 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-blue-500 w-0 transition-all duration-300"></div>
                </div>
            </div>

            <h2 id="question-text" class="text-xl font-bold text-slate-800 mb-8 leading-normal">題目載入中...</h2>

            <div id="options-container" class="space-y-3">
                </div>
        </div>
    </div>

    <div id="page-loading" class="hidden min-h-screen flex-col items-center justify-center p-4 text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
        <h2 class="text-xl font-bold text-slate-800">正在傳送資料...</h2>
        <p class="text-slate-500 text-sm">請稍候，請勿關閉視窗</p>
    </div>

    <div id="page-result" class="hidden min-h-screen flex flex-col items-center justify-center p-4 text-center">
        <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6 shadow-green-200 shadow-lg fade-in">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
        </div>
        <h2 class="text-3xl font-bold text-slate-900 mb-4 fade-in">測驗已完成</h2>
        <div class="bg-white p-8 rounded-xl border border-slate-100 shadow-lg max-w-md w-full mb-8 text-left fade-in">
            <p class="text-slate-600 leading-relaxed mb-4">
                感謝您完成本次職能適性測驗。您的回答資料已成功上傳至系統資料庫。
            </p>
            <p class="text-slate-500 text-sm border-t border-slate-100 pt-4">
                HR 團隊將會儘速審閱您的評估結果，若有進一步消息將會主動聯繫您。現在您可以安心關閉此視窗。
            </p>
        </div>
        
        <button onclick="location.reload()" class="fade-in px-8 py-3 bg-white border border-slate-300 rounded-xl font-semibold text-slate-600 hover:bg-slate-50 transition shadow-sm">
            返回首頁
        </button>
    </div>

    <script>
        // ==========================================
        // 設定區：Google Apps Script 網址
        // ==========================================
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx9bzLseYK3xu6ECDomN-TBgmZps_zwcFkcFyXp8wnTA1axxDGjNZnkzqem2YOx6jJ-sw/exec"; 
        // ==========================================

        // --- 1. 題庫資料 ---
        const QUESTIONS = [
            {
                id: 1, text: "當團隊遇到一個突發的緊急問題時，你通常的第一反應是？",
                options: [
                    { id: "A", text: "立即接手，指揮大家該做什麼，目標是快速解決問題。", value: "D" },
                    { id: "B", text: "先安撫大家的情緒，鼓勵團隊一起想辦法，保持氣氛樂觀。", value: "I" },
                    { id: "C", text: "先觀察情況，詢問他人的意見，確保大家的步調一致。", value: "S" },
                    { id: "D", text: "冷靜分析問題的根源，制定詳細的解決計劃後再行動。", value: "C" }
                ]
            },
            {
                id: 2, text: "在一個新專案開始時，你最關心的是什麼？",
                options: [
                    { id: "A", text: "這個專案的目標是什麼？能不能帶來顯著的成果？", value: "D" },
                    { id: "B", text: "誰會參與這個專案？我們會怎麼合作？過程有趣嗎？", value: "I" },
                    { id: "C", text: "我們有足夠的支援嗎？變動會不會太大？", value: "S" },
                    { id: "D", text: "詳細的規格是什麼？流程是否清晰且合乎邏輯？", value: "C" }
                ]
            },
            {
                id: 3, text: "如果你的意見與主管不同，你會怎麼做？",
                options: [
                    { id: "A", text: "直接提出我的看法，並列舉理由試圖說服主管。", value: "D" },
                    { id: "B", text: "私下找機會委婉地聊聊，用比較輕鬆的方式表達想法。", value: "I" },
                    { id: "C", text: "如果不影響大局，我會配合主管的決定，維持和諧。", value: "S" },
                    { id: "D", text: "準備好數據和資料佐證，以書面或正式方式提出修正建議。", value: "C" }
                ]
            },
            {
                id: 4, text: "你希望獲得什麼樣的工作回饋？",
                options: [
                    { id: "A", text: "直接、簡潔，告訴我哪裡做得好，哪裡需要改進即可。", value: "D" },
                    { id: "B", text: "公開的表揚和肯定，讓我覺得自己受到重視。", value: "I" },
                    { id: "C", text: "真誠且私下的鼓勵，讓我知道我的努力有被看見。", value: "S" },
                    { id: "D", text: "具體、精確的評估，針對細節給予建設性的分析。", value: "C" }
                ]
            },
            {
                id: 5, text: "在週末或休閒時間，你通常喜歡做什麼？",
                options: [
                    { id: "A", text: "參加競技運動或挑戰新事物，保持活躍。", value: "D" },
                    { id: "B", text: "和一大群朋友聚會、參加派對或社交活動。", value: "I" },
                    { id: "C", text: "在家休息、陪伴家人，或做一些熟悉的休閒活動。", value: "S" },
                    { id: "D", text: "閱讀、研究感興趣的主題，或是整理家務。", value: "C" }
                ]
            },
            {
                id: 6, text: "面對繁瑣且重複性高的行政工作，你的態度是？",
                options: [
                    { id: "A", text: "覺得很浪費時間，希望能授權給別人做，或者快速做完。", value: "D" },
                    { id: "B", text: "容易分心，需要中間穿插一些有趣的互動才能完成。", value: "I" },
                    { id: "C", text: "這是工作的一部分，我會耐心地把它做完。", value: "S" },
                    { id: "D", text: "這很重要，我會建立一套系統流程來確保零失誤。", value: "C" }
                ]
            }
        ];

        // --- 2. 邏輯控制 ---
        let currentQIndex = 0;
        let scores = { D: 0, I: 0, S: 0, C: 0 };
        let candidateName = "";

        function showPage(pageId) {
            document.querySelectorAll('body > div').forEach(div => div.classList.add('hidden'));
            document.querySelectorAll('body > div').forEach(div => div.classList.remove('flex'));
            const target = document.getElementById(pageId);
            target.classList.remove('hidden');
            target.classList.add('flex');
        }

        function startQuiz() {
            const nameInput = document.getElementById('candidate-name');
            if (!nameInput.value.trim()) { alert("請輸入姓名"); return; }
            candidateName = nameInput.value;
            currentQIndex = 0;
            scores = { D: 0, I: 0, S: 0, C: 0 };
            renderQuestion();
            showPage('page-quiz');
        }

        function renderQuestion() {
            const q = QUESTIONS[currentQIndex];
            document.getElementById('q-current').innerText = currentQIndex + 1;
            document.getElementById('q-total').innerText = QUESTIONS.length;
            document.getElementById('question-text').innerText = q.text;
            
            // 更新進度條
            const percent = ((currentQIndex) / QUESTIONS.length) * 100;
            document.getElementById('progress-bar').style.width = `${percent}%`;

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded-xl border border-slate-200 hover:border-blue-500 hover:bg-blue-50 transition duration-200 flex items-center group";
                btn.innerHTML = `
                    <span class="w-6 h-6 rounded-full border border-slate-300 text-xs flex items-center justify-center mr-3 group-hover:border-blue-500 group-hover:text-blue-600 text-slate-400 font-mono">${opt.id}</span>
                    <span class="text-slate-700 group-hover:text-blue-900">${opt.text}</span>
                `;
                btn.onclick = () => handleAnswer(opt.value);
                container.appendChild(btn);
            });
        }

        function handleAnswer(value) {
            scores[value]++;
            currentQIndex++;
            if (currentQIndex < QUESTIONS.length) {
                renderQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            showPage('page-loading');
            setTimeout(calculateResult, 1000); 
        }

        // --- 3. 分析結果邏輯 (包含傳送資料到 Google Sheets) ---
        function calculateResult() {
            // 找出最高分的特質
            let maxScore = -1;
            let maxType = 'D';
            for (let type in scores) {
                if (scores[type] > maxScore) {
                    maxScore = scores[type];
                    maxType = type;
                }
            }

            // ★★★ 隱藏式處理 ★★★
            // 我們這裡不再更新「畫面上的結果」(因為畫面已經改掉了)，
            // 而是直接把算出來的 maxType 傳給後台。
            sendToGoogleSheets(maxType);
            
            // 顯示感謝頁面
            showPage('page-result');
        }

        function sendToGoogleSheets(resultType) {
            // 建立要傳送的資料
            const formData = new FormData();
            formData.append('name', candidateName);
            formData.append('type', resultType);
            formData.append('score_d', scores['D']);
            formData.append('score_i', scores['I']);
            formData.append('score_s', scores['S']);
            formData.append('score_c', scores['C']);

            // 發送請求
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                body: formData,
                mode: 'no-cors' 
            }).then(() => {
                console.log("資料已成功傳送至後台");
            }).catch(error => {
                console.error("傳送失敗:", error);
            });
        }
    </script>
</body>
</html>
